TODO
----

Code:
  - add support for Power
    - new 'mode' option: 'Energy' / 'Power'
    - single-entities for Grid/Battery/Devices
    - no stats-gathering, just sensors
    - sensor types are now Power and Measurement
    - support State-of-Charge for Battery
      - this could be done using the secondary, although then we'd need to know that it was a SoC in order to manage the main icon
    - see what else should be changed/hidden
  - unit-testing
  - the 'loading' state should not be displayed when rolling over to the next period
    - this can be done by comparing the new 'startPeriod' to the previous 'endPeriod': if they are the same, it's a rollover rather than a new range
      - note that 'endPeriod' needs to be incremented by 1 day and then reset to the start-of-day!
      - problem: how to differentiate between an automatic rollover and a manual one?  We'd want the 'loading' display in the latter case, as it might be a slow load!
        - only an issue for the date-picker mode, since there is no manual update possible otherwise
          - the only one which is automated here is the daily-rollover, so that can be detected
    - the state should also be an enum:
      - requested (ie, 'loading')
      - received (ie, ready for display)
      - timed-out
        - this then replaces the current log to the console
  - layout:
    - eliminate empty columns
  - editor:
    - refactor out the dropdown options lists, there's a lot of duplication going on!

Editor:
  - dynamic labelling for, eg, Battery's import ('discharge') and export ('charge') fields in the UI
    - also for Devices, where 'export' ('consumption') and 'import' ('production') will be confusing!
      - and the main colours should be 'Flow'
    - it's too much work to change the underlying config fields, so this is strictly a cosmetic thing in the UK
  - Devices page-link not showing its status-icon

Config:
  - import Devices from the ED config
    - only those which do not have a parent
    - import entity and name
    - this might be best driven by the user, rather that done automatically
  - for Devices, have a flag which specifies when it was imported from the Energy Dashboard config?
    - this would have several effects:
      - the name and entity would not be editable
      - if the ED config were changed to remove the device, we could reflect that change here too
        - although that might be confusing, so it might be better to give the user the option
    - if the ED config's entity is changed, though, there's no way to detect that - it would appear as a 'delete' and an 'add', which loses the card's config
    - usefully, the ED config does not allow the same entity to be specified twice
    - might not be all that useful, though:
      - we can't detect changes, only add/remove
      - without the flag, we just pick up the new devices

Display:
  - Home:
    - include producing devices in the segment arrays
    - if 'subtract' is set, subtract consuming devices from the appropriate total
  - Devices:
    - if there is exactly one device:
      - if there is no Gas configured, draw it in the upper-right
      - else draw it in the lower-right (removing the 'Home' label)
    - if there are exactly two devices and Gas is not configured, draw upper/lower right
    - otherwise attempt to expand to the right
    - if there is not enough space for the required number of columns, expand below instead
    - for rightwards, draw the bus out from the Home circle and position devices above/below it
      - could try to get clever and stop the bus one column from the end so we can fit three devices in a column
    - for downwards, draw the bus from the bottom of the Home circle, then turn left to the centre column and then downwards
      - this occpuies the first 'row' below the standard 3x3 grid (or 3x2 if no battery is present)
      - devices now go to the left/right of the bus
        - and again, the bottom-most row could contain three devices


Under consideration
-------------------

  - may be able to remove pruneConfig() now
    - or not: if 'overrides' is cleared, you get an empty object in the config...
    - but see if it can be used to filter out 'bad' config rather than forcing the user into YAML mode
      - or failing that - is there any way to find out from validation what the bad config is so we can at least *tell* the user?
        - looks like it - see superstruct
  - alternative flow algorithm which prioritises House->Battery->Grid
    - implementation:
      - define consts/enum for the four nodes: House, Grid, Battery, Solar
      - define arrays of 'producer order' and 'consumer order': these use the consts
      - inside the flow-calculation:
        - use the five supplied values plus the calculated 'to house' value to populate an array of nodes, where each entry is a tuple{producer,consumer} using 'undefined' where appropriate
        - iterate over the selected 'producer order' array
          - for each producer, iterate over the 'consumer order' array, skipping where producer==consumer
          - calculate the producer->consumer flow value at this point and increment the corresponding entry in a 2d-array, where the first index is the 'producer' and the second the 'consumer'
        - finally, pull the values out of the 2d-array and populate the Flows object as normal
      - check whether this actually matches how the HASS algo works!
        - might, for example, need per-producer 'consumer order' arrays rather than a single one
      - the arrays are selected based on the config, eg:
        - for HASS the 'producer' might be [Solar,Battery,Grid] and 'consumer' [Battery,Grid,House]
        - whereas for a more realistic approach the 'consumer' would be [House,Battery,Grid]
        - we can give the user some degree of control here if/as required, but the basic algo should cope with any setup
  - redesign the render code so that it's static, only refreshing on a config/layout change, and the states/css/etc are poked into it on a data-update


Before release
--------------

  - rename to 'Energy Distribution Extended' (energy-distribution-ext) for consistency with the built-in card
    - or something else, given Power support as well
  - README and CHANGELOG updates
  - add license
  - reinstate terser in rollup.config.js
  - check against the Plus cards for missing/broken functionality
  - check against the Plus issue-lists for features which might be worth adding
