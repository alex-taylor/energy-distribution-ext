TODO
----

Code
----

  - ui-editor:
    - remove-defaults should strip redundant (ie, mode-specific) values out completely
      - this leaves a problem: it removes user settings which should be reinstated if they switch between modes with the dialog still open
      - so:
        - before pruning, if the mode of the new config has changed (compare to this._config):
          -copy the relevant mode-specific fields from this._last<mode>Config to the new config
            - for Energy, these are:
              - import_entities / export_entities on battery/gas/grid/solar/devices
              - date-range settings
              - electric/gas unit settings
              - anything else?
            - for Power, these are:
              - power_entities on battery/gas/grid/solar/devices
              - anything else?
          - save the new config to this._last<mode>Config
        - prune and send the event

  - see if we can filter out 'bad' config rather than forcing the user into YAML mode
    - or failing that - is there any way to find out from validation what the bad config is so we can at least *tell* the user?
      - looks like it - see superstruct
    - should be able to detect invalid enum values: right now they are validated (because it accepts any string), but cannot be parsed which dumps the user into YAML mode with no way of knowing what caused this

  - BUG: the dots are being rendered at the (0,0) of the lines panel
    - may now be fixed?
  - BUG: the 'Loading' message appears over a very short card, looks like while the lines are being rendered the nodes are not
    - may now be fixed?



Under consideration
-------------------

  - alternative flow algorithm which prioritises House->Battery->Grid
    - implementation:
      - define consts/enum for the four nodes: House, Grid, Battery, Solar
      - define arrays of 'producer order' and 'consumer order': these use the consts
      - inside the flow-calculation:
        - use the five supplied values plus the calculated 'to house' value to populate an array of nodes, where each entry is a tuple{producer,consumer} using 'undefined' where appropriate
        - iterate over the selected 'producer order' array
          - for each producer, iterate over the 'consumer order' array, skipping where producer==consumer
          - calculate the producer->consumer flow value at this point and increment the corresponding entry in a 2d-array, where the first index is the 'producer' and the second the 'consumer'
        - finally, pull the values out of the 2d-array and populate the Flows object as normal
      - check whether this actually matches how the HASS algo works!
        - might, for example, need per-producer 'consumer order' arrays rather than a single one
      - the arrays are selected based on the config, eg:
        - for HASS the 'producer' might be [Solar,Battery,Grid] and 'consumer' [Battery,Grid,House]
        - whereas for a more realistic approach the 'consumer' would be [House,Battery,Grid]
        - we can give the user some degree of control here if/as required, but the basic algo should cope with any setup
  - redesign the render code so that it's static, only refreshing on a config/layout change, and the states/css/etc are poked into it on a data-update


Before release
--------------

  - rename to 'Energy Distribution Extended' (energy-distribution-ext) for consistency with the built-in card
    - or something else, given Power support as well
  - look into better default colours for devices which work in both light and dark modes
  - README and CHANGELOG updates
  - unit-testing
  - add license
  - reinstate terser in rollup.config.js
  - check against the Plus cards for missing/broken functionality
  - check against the Plus issue-lists for features which might be worth adding
